<p-drawer
  [visible]="visible()"
  (visibleChange)="onVisibleChange($event)"
  position="right"
  [modal]="true"
  styleClass="w-full md:w-30rem"
>
  <ng-template #header>
    <div class="flex items-center gap-3">
      <i class="pi pi-filter text-2xl text-blue-600"></i>
      <h2 class="text-xl font-bold text-gray-900">Filtros Avanzados</h2>
    </div>
  </ng-template>

  <!-- Content -->
  <div class="space-y-6 py-2">
    <form [formGroup]="form" class="space-y-6">
      <!-- Filtro de Fecha -->
      <div class="flex flex-col gap-3">
        <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
          <i class="pi pi-calendar text-blue-600"></i>
          Rango de Fechas
        </label>

        <p-datepicker
          formControlName="dateRange"
          selectionMode="range"
          [showIcon]="true"
          [maxDate]="maxDate()"
          dateFormat="dd/mm/yy"
          placeholder="Seleccione rango de fechas"
          styleClass="w-full"
          (onSelect)="onDateRangeChange()"
        />

        <p class="text-xs text-gray-500">
          Filtra órdenes en el rango de fechas seleccionado
        </p>
      </div>

      <p-divider />

      <!-- Filtro de Países -->
      <div class="flex flex-col gap-3">
        <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
          <i class="pi pi-globe text-blue-600"></i>
          Países
        </label>

        <p-multiselect
          formControlName="selectedCountries"
          [options]="countries()"
          optionLabel="name"
          optionValue="id"
          placeholder="Seleccione países"
          [filter]="true"
          filterPlaceholder="Buscar país..."
          [loading]="isLoadingData()"
          styleClass="w-full"
          [showToggleAll]="true"
          [maxSelectedLabels]="2"
          selectedItemsLabel="{0} países seleccionados"
        />

        <p class="text-xs text-gray-500">
          Filtra órdenes por países específicos
        </p>
      </div>

      <p-divider />

      <!-- Filtro de Ciudades -->
      <div class="flex flex-col gap-3">
        <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
          <i class="pi pi-map-marker text-blue-600"></i>
          Ciudades
        </label>

        <p-multiselect
          formControlName="selectedCities"
          [options]="cities()"
          optionLabel="name"
          optionValue="id"
          placeholder="Seleccione ciudades"
          [filter]="true"
          filterPlaceholder="Buscar ciudad..."
          [loading]="isLoadingData()"
          styleClass="w-full"
          [showToggleAll]="true"
          [maxSelectedLabels]="2"
          selectedItemsLabel="{0} ciudades seleccionadas"
        />

        <p class="text-xs text-gray-500">
          Filtra órdenes por ciudades específicas
        </p>
      </div>
    </form>
  </div>

  <!-- Footer -->
  <ng-template #footer>
    <div class="flex flex-col gap-2">
      <p-button
        label="Aplicar Filtros"
        icon="pi pi-check"
        styleClass="w-full"
        (onClick)="applyFilters()"
      />
      <div class="flex gap-2">
        <p-button
          label="Limpiar"
          icon="pi pi-times"
          severity="secondary"
          [outlined]="true"
          styleClass="flex-1"
          (onClick)="clearFilters()"
        />
        <p-button
          label="Cancelar"
          severity="secondary"
          [outlined]="true"
          styleClass="flex-1"
          (onClick)="close()"
        />
      </div>
    </div>
  </ng-template>
</p-drawer>
