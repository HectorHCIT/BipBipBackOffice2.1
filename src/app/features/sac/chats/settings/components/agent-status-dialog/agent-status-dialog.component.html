<p-dialog
  [visible]="visible()"
  (visibleChange)="onClose()"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '32rem' }"
  styleClass="p-fluid"
>
  <ng-template pTemplate="header">
    <div class="flex items-center gap-3">
      <i class="pi pi-user text-2xl"></i>
      <div>
        <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">
          {{ agent()?.name }}
        </h3>
        <p class="text-sm text-gray-500 dark:text-gray-400">Cambiar estado del agente</p>
      </div>
    </div>
  </ng-template>

  @if (agent()) {
    <div class="space-y-4">
      <!-- Estado Actual -->
      <div class="flex items-center gap-2 p-3 bg-surface-50 dark:bg-surface-800 rounded-lg">
        <div class="w-3 h-3 rounded-full" [ngClass]="getStatusClass(agent()!.currentStatus)"></div>
        <span class="font-medium text-gray-900 dark:text-gray-100">
          Estado actual: <span class="capitalize">{{ agent()!.currentStatus }}</span>
        </span>
      </div>

      <!-- InformaciÃ³n del Agente -->
      <div class="grid grid-cols-2 gap-3 text-sm">
        <div>
          <span class="text-gray-500 dark:text-gray-400">Usuario:</span>
          <p class="font-medium text-gray-900 dark:text-gray-100">{{ agent()!.username }}</p>
        </div>
        <div>
          <span class="text-gray-500 dark:text-gray-400">Chats activos:</span>
          <p class="font-medium text-gray-900 dark:text-gray-100">{{ agent()!.activeChatRooms }}</p>
        </div>
      </div>

      <!-- Advertencia si tiene chats activos -->
      @if (agent()!.activeChatRooms > 0) {
        <div class="flex gap-2 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
          <i class="pi pi-exclamation-triangle text-yellow-600"></i>
          <p class="text-sm text-yellow-800 dark:text-yellow-200">
            Este agente tiene {{ agent()!.activeChatRooms }} chat(s) activo(s). No se puede cambiar el estado.
          </p>
        </div>
      }

      <!-- Opciones de Estado -->
      @if (agent()!.activeChatRooms === 0) {
        <div class="space-y-2">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
            Seleccionar nuevo estado:
          </label>
          <div class="flex flex-col gap-2">
            @for (option of statusOptions; track option.value) {
              <button
                type="button"
                class="px-4 py-3 text-left rounded-lg transition-all border"
                [class]="selectedStatus() === option.value
                  ? 'bg-blue-500 text-white border-blue-600'
                  : 'bg-surface-0 dark:bg-surface-800 hover:bg-surface-50 dark:hover:bg-surface-700 border-surface-200 dark:border-surface-700'"
                (click)="selectStatus(option.value)"
              >
                <div class="flex items-center gap-2">
                  <div class="w-2.5 h-2.5 rounded-full" [ngClass]="getStatusClass(option.value)"></div>
                  <span class="font-medium capitalize">{{ option.label }}</span>
                </div>
              </button>
            }
          </div>
        </div>
      }
    </div>
  }

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2">
      <p-button
        label="Cancelar"
        severity="secondary"
        [outlined]="true"
        (onClick)="onClose()"
      />
      <p-button
        label="Actualizar Estado"
        [disabled]="agent()!.activeChatRooms > 0"
        (onClick)="onConfirm()"
      />
    </div>
  </ng-template>
</p-dialog>
