@if (!isAdmin) {
  <!-- Overlay de drag and drop -->
  @if (isDragging) {
    <div class="drag-overlay">
      <div class="drag-overlay__content">
        <div class="drag-overlay__icon">
          <i class="pi pi-cloud-upload"></i>
        </div>
        <p class="drag-overlay__title">Suelta la imagen aquí</p>
        <p class="drag-overlay__subtitle">Máximo 5MB</p>
      </div>
    </div>
  }

  <!-- Preview de imagen seleccionada -->
  @if (selectedImage) {
    <div class="image-preview">
      <div class="image-preview__content">
        <!-- Imagen preview -->
        <div class="image-preview__thumbnail">
          <img
            [src]="selectedImage"
            alt="Imagen seleccionada"
            class="image-preview__img"
          />

          <!-- Overlay de cargando -->
          @if (sendingImage) {
            <div class="image-preview__loading">
              <p-progressSpinner
                [style]="{ width: '24px', height: '24px' }"
                strokeWidth="3"
                fill="transparent"
              />
            </div>
          }
        </div>

        <!-- Info de la imagen -->
        <div class="image-preview__info">
          <p class="image-preview__filename">{{ getFileName() }}</p>
          <p class="image-preview__filesize">{{ getFileSize() }}</p>
        </div>

        <!-- Botón para quitar -->
        @if (!sendingImage) {
          <p-button
            icon="pi pi-times"
            [rounded]="true"
            [text]="true"
            severity="secondary"
            (onClick)="clearImage()"
            [title]="'Quitar imagen'"
            styleClass="image-preview__remove"
          />
        }
      </div>
    </div>
  }

  <!-- Input principal -->
  <div
    class="chat-input"
    [class.chat-input--disabled]="disabled"
    [class.chat-input--dragging]="isDragging"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
  >
    <!-- Textarea de mensaje -->
    <textarea
      #messageInput
      pInputTextarea
      [placeholder]="placeholder"
      [(ngModel)]="message"
      (input)="onMessageInput($event)"
      (keydown)="onKeyDown($event)"
      [disabled]="disabled || sendingImage"
      [rows]="1"
      [autoResize]="true"
      class="chat-input__textarea"
    ></textarea>

    <!-- Acciones -->
    <div class="chat-input__actions">
      <!-- Botón de emoji picker -->
      <p-button
        icon="pi pi-face-smile"
        [rounded]="true"
        [text]="true"
        severity="secondary"
        size="small"
        (onClick)="toggleEmojiPicker($event)"
        [title]="'Añadir emoji'"
      />

      <!-- Popover del emoji picker -->
      <p-popover #emojiPanel>
        <app-emoji-picker (emojiSelect)="addEmoji($event)" />
      </p-popover>

      <!-- Botón de adjuntar archivo -->
      @if (showFileAttach) {
        <p-button
          icon="pi pi-paperclip"
          [rounded]="true"
          [text]="true"
          severity="secondary"
          size="small"
          (onClick)="triggerFileInput()"
          [title]="'Adjuntar imagen'"
        />

        <input
          #fileInput
          type="file"
          (change)="onFileSelected($event)"
          accept="image/*"
          class="hidden"
        />
      }

      <!-- Botón de respuestas predefinidas -->
      @if (showPredefinedResponses) {
        <p-button
          icon="pi pi-comment"
          [rounded]="true"
          [text]="true"
          severity="secondary"
          size="small"
          (onClick)="openResponseDialog()"
          [title]="'Respuestas predefinidas'"
        />
      }

      <!-- Botón de enviar -->
      <p-button
        icon="pi pi-send"
        [rounded]="true"
        severity="danger"
        size="small"
        [disabled]="(!message.trim() && !selectedImageFile) || disabled || sendingImage"
        (onClick)="handleSubmit()"
        [title]="'Enviar mensaje'"
      />
    </div>
  </div>
} @else {
  <!-- Mensaje para admins que no pueden enviar mensajes -->
  <div class="admin-message">
    <p>Los administradores no pueden enviar mensajes en este chat</p>
  </div>
}
