<div class="container-fluid">
  <!-- Breadcrumb -->
  <p-breadcrumb
    [model]="breadcrumbItems"
    [home]="home"
    styleClass="bg-transparent border-none p-0 mb-4"
  />

  <!-- Card Principal -->
  <p-card>
    <ng-template pTemplate="header">
      <div class="px-4 pt-4">
        <h2 class="text-2xl font-semibold m-0">Reporte de Ocurrencias / Incidencias</h2>
        <p class="text-surface-500 mt-2 mb-0">
          Genera reportes de ocurrencias filtrados por fechas, ciudades y marcas
        </p>
      </div>
    </ng-template>

    <ng-template pTemplate="content">
      <form [formGroup]="form" class="flex flex-col gap-4">
        <!-- Rango de Fechas -->
        <div class="flex flex-col gap-2">
          <label for="dateRange" class="font-semibold">
            Rango de Fechas <span class="text-red-500">*</span>
          </label>
          <p-datepicker
            inputId="dateRange"
            formControlName="dateRange"
            selectionMode="range"
            [maxDate]="maxDate"
            dateFormat="dd/mm/yy"
            [showIcon]="true"
            placeholder="Selecciona un rango de fechas"
            styleClass="w-full"
            [readonlyInput]="true"
          />
        </div>

        <!-- Ciudades -->
        <div class="flex flex-col gap-2">
          <label for="cities" class="font-semibold">
            Ciudades (Opcional)
          </label>
          <p-multiselect
            inputId="cities"
            formControlName="cities"
            [options]="cities()"
            optionLabel="name"
            optionValue="id"
            placeholder="Selecciona ciudades"
            [filter]="true"
            filterPlaceHolder="Buscar ciudad"
            [showClear]="true"
            appendTo="body"
            styleClass="w-full"
          >
            <ng-template pTemplate="selectedItems" let-value>
              @if (value && value.length > 0) {
                <div class="flex items-center gap-1">
                  <span>{{ value.length }} ciudad(es) seleccionada(s)</span>
                </div>
              } @else {
                <span>Selecciona ciudades</span>
              }
            </ng-template>
          </p-multiselect>
          <small class="text-surface-500">
            Deja vacío para incluir todas las ciudades
          </small>
        </div>

        <!-- Marcas -->
        <div class="flex flex-col gap-2">
          <label for="brands" class="font-semibold">
            Marcas (Opcional)
          </label>
          <p-multiselect
            inputId="brands"
            formControlName="brands"
            [options]="brands()"
            optionLabel="name"
            optionValue="id"
            placeholder="Selecciona marcas"
            [filter]="true"
            filterPlaceHolder="Buscar marca"
            [showClear]="true"
            appendTo="body"
            styleClass="w-full"
          >
            <ng-template pTemplate="selectedItems" let-value>
              @if (value && value.length > 0) {
                <div class="flex items-center gap-1">
                  <span>{{ value.length }} marca(s) seleccionada(s)</span>
                </div>
              } @else {
                <span>Selecciona marcas</span>
              }
            </ng-template>
          </p-multiselect>
          <small class="text-surface-500">
            Deja vacío para incluir todas las marcas
          </small>
        </div>

        <!-- Información -->
        <div class="flex items-start gap-2 text-sm text-blue-600 bg-blue-50 px-3 py-2 rounded">
          <i class="pi pi-info-circle mt-0.5"></i>
          <span>Los filtros de ciudades y marcas son opcionales. Si no seleccionas ninguno, el reporte incluirá todos los datos.</span>
        </div>

        <!-- Botones de Acción -->
        <div class="flex gap-2 justify-end mt-4">
          <p-button
            label="Limpiar"
            icon="pi pi-times"
            severity="secondary"
            [outlined]="true"
            (onClick)="clearForm()"
            [disabled]="isLoading()"
          />
          <p-button
            label="Generar Reporte Excel"
            icon="pi pi-file-excel"
            (onClick)="generateReport()"
            [loading]="isLoading()"
          />
        </div>
      </form>
    </ng-template>
  </p-card>
</div>

<!-- Toast para notificaciones -->
<p-toast />
