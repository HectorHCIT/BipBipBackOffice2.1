<p-dialog
  [visible]="visible()"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="w-full max-w-xl"
  (visibleChange)="visibleChange.emit($event)"
>
  <ng-template #header>
    <div class="flex items-center gap-3">
      <i class="pi pi-times-circle text-2xl text-red-600"></i>
      <div>
        <h3 class="text-xl font-semibold text-gray-900">Denegar Solicitud de Cancelación</h3>
        <p class="text-sm text-gray-600 mt-1">Orden #{{ request().orderId }}</p>
      </div>
    </div>
  </ng-template>

  <form [formGroup]="denyForm" class="space-y-4">
    <!-- Info Alert -->
    <div class="border-l-4 border-red-500 bg-red-50 p-4 rounded">
      <div class="flex items-start gap-2">
        <i class="pi pi-info-circle text-red-600 mt-0.5"></i>
        <div class="flex-1">
          <h4 class="text-sm font-semibold text-red-800 mb-1">Información de la Solicitud</h4>
          <p class="text-sm text-red-700 mb-2">
            <strong>Solicitado por:</strong> {{ request().userRequest }}
          </p>
          <p class="text-sm text-red-700 mb-2">
            <strong>Fecha:</strong> {{ request().dateRequest | date:'dd/MM/yyyy HH:mm' }}
          </p>
          @if (request().comment) {
            <p class="text-sm text-red-700">
              <strong>Comentario:</strong> {{ request().comment }}
            </p>
          }
        </div>
      </div>
    </div>

    <!-- Comment -->
    <div class="flex flex-col gap-2">
      <label for="comment" class="text-sm font-semibold text-gray-700">
        Motivo del Rechazo <span class="text-red-500">*</span>
      </label>
      <p class="text-xs text-gray-600 mb-1">
        Explique detalladamente por qué se está denegando esta solicitud de cancelación
      </p>
      <textarea
        pTextarea
        id="comment"
        formControlName="comment"
        placeholder="Ej: La orden ya fue enviada y está en camino al cliente"
        rows="5"
        class="w-full"
        [class.ng-invalid]="isFieldInvalid('comment')"
        [class.ng-dirty]="isFieldInvalid('comment')"
      ></textarea>
      @if (isFieldInvalid('comment')) {
        <small class="text-red-500">{{ getFieldError('comment') }}</small>
      }
    </div>

    <!-- Warning -->
    <div class="border-l-4 border-yellow-500 bg-yellow-50 p-4 rounded">
      <div class="flex items-start gap-2">
        <i class="pi pi-exclamation-triangle text-yellow-600 mt-0.5"></i>
        <div>
          <h4 class="text-sm font-semibold text-yellow-800">Importante</h4>
          <p class="text-sm text-yellow-700 mt-1">
            Al denegar esta solicitud, el cliente será notificado y la orden continuará activa.
            El comentario será visible para el cliente.
          </p>
        </div>
      </div>
    </div>
  </form>

  <ng-template #footer>
    <div class="flex justify-end gap-2">
      <p-button
        label="Cancelar"
        severity="secondary"
        [outlined]="true"
        (onClick)="onCancel()"
        [disabled]="loading()"
      />
      <p-button
        label="Denegar Solicitud"
        severity="danger"
        icon="pi pi-times"
        (onClick)="onSubmit()"
        [loading]="loading()"
        [disabled]="denyForm.invalid"
      />
    </div>
  </ng-template>
</p-dialog>
