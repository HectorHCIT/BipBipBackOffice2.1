<div class="cancellation-requests-container p-4">
  <!-- Header -->
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-semibold text-gray-900">
      Solicitudes de Cancelación
      @if (cancelRequests().length > 0) {
        <span class="text-sm font-normal text-gray-600 ml-2">({{ cancelRequests().length }} solicitudes)</span>
      }
    </h3>
  </div>

  <!-- Empty State -->
  @if (isEmpty()) {
    <div class="border border-gray-200 bg-gray-50 rounded-lg p-8 text-center">
      <i class="pi pi-inbox text-4xl text-gray-400 mb-3"></i>
      <h4 class="text-lg font-semibold text-gray-700 mb-2">No hay solicitudes de cancelación</h4>
      <p class="text-sm text-gray-600">
        Esta orden no tiene solicitudes de cancelación registradas.
      </p>
    </div>
  }

  <!-- Table with Data -->
  @else {
    <div class="border border-gray-200 rounded-lg overflow-hidden">
      <p-table
        [value]="cancelRequests()"
        [tableStyle]="{ 'min-width': '50rem' }"
        styleClass="p-datatable-sm"
      >
        <ng-template #header>
          <tr>
            <th class="text-left">Fecha de Solicitud</th>
            <th class="text-left">Usuario</th>
            <th class="text-left">Tienda</th>
            <th class="text-left">Canal</th>
            <th class="text-center">Producto Preparado</th>
            <th class="text-left">Estado</th>
            <th class="text-center" style="width: 180px">Acciones</th>
          </tr>
        </ng-template>
        <ng-template #body let-request>
          <tr>
            <!-- Fecha -->
            <td>
              <div class="flex flex-col gap-1">
                <span class="text-sm font-medium text-gray-900">
                  {{ request.dateRequest | date:'dd/MM/yyyy' }}
                </span>
                <span class="text-xs text-gray-500">
                  {{ request.dateRequest | date:'HH:mm:ss' }}
                </span>
              </div>
            </td>

            <!-- Usuario -->
            <td>
              <div class="flex flex-col gap-1">
                <span class="text-sm text-gray-900">{{ request.userRequest }}</span>
                @if (request.userAproved) {
                  <span class="text-xs text-gray-500">Procesado: {{ request.userAproved }}</span>
                }
              </div>
            </td>

            <!-- Tienda -->
            <td>
              <span class="text-sm text-gray-900">{{ request.store }}</span>
            </td>

            <!-- Canal -->
            <td>
              <span class="text-sm text-gray-900">{{ request.channel }}</span>
            </td>

            <!-- Producto Preparado -->
            <td class="text-center">
              @if (request.productWasPrepared) {
                <p-badge value="Sí" severity="warn" styleClass="text-xs" />
              } @else {
                <p-badge value="No" severity="success" styleClass="text-xs" />
              }
            </td>

            <!-- Estado -->
            <td>
              <p-badge
                [value]="request.status"
                [severity]="getStatusSeverity(request.status)"
                styleClass="text-xs"
              />
            </td>

            <!-- Acciones -->
            <td class="text-center">
              @if (isPending(request.status)) {
                <div class="flex gap-2 justify-center">
                  <p-button
                    label="Aprobar"
                    icon="pi pi-check"
                    severity="success"
                    size="small"
                    (onClick)="onApproveRequest(request)"
                    [outlined]="true"
                  />
                  <p-button
                    label="Denegar"
                    icon="pi pi-times"
                    severity="danger"
                    size="small"
                    (onClick)="onDenyRequest(request)"
                    [outlined]="true"
                  />
                </div>
              } @else {
                <span class="text-xs text-gray-500">-</span>
              }
            </td>
          </tr>

          <!-- Expandible row - Comentarios -->
          @if (request.comment) {
            <tr>
              <td colspan="7" class="bg-gray-50">
                <div class="p-3 border-l-4 border-blue-400">
                  <p class="text-xs font-semibold text-gray-700 uppercase mb-1">Comentario</p>
                  <p class="text-sm text-gray-900">{{ request.comment }}</p>
                </div>
              </td>
            </tr>
          }
        </ng-template>
      </p-table>
    </div>
  }
</div>
