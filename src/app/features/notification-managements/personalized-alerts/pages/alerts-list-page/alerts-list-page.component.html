<div class="grid">
  <div class="col-12">
    <p-card>
      <ng-template pTemplate="header">
        <div class="flex justify-between items-center p-4">
          <h2 class="text-2xl font-bold m-0">Alertas Personalizadas</h2>
          <p-button
            label="Nueva Alerta"
            icon="pi pi-plus"
            (onClick)="onCreateAlert()"
          />
        </div>
      </ng-template>

      <!-- Search -->
      <div class="mb-4">
        <span class="p-input-icon-left w-full md:w-1/2">
          <i class="pi pi-search"></i>
          <input
            type="text"
            pInputText
            placeholder="Buscar por código, título o subtítulo..."
            class="w-full"
            [value]="searchTerm()"
            (input)="onSearch($event)"
          />
        </span>
      </div>

      <!-- Table -->
      <p-table
        [value]="filteredAlerts()"
        [loading]="isLoading()"
        [tableStyle]="{ 'min-width': '50rem' }"
        styleClass="p-datatable-sm"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Preview</th>
            <th>Código</th>
            <th>Icono</th>
            <th>Título</th>
            <th>Subtítulo</th>
            <th>Colores</th>
            <th style="width: 150px">Acciones</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-alert>
          <tr>
            <td>
              <div
                class="inline-flex items-center gap-2 rounded px-3 py-2 text-sm"
                [style.background-color]="'#' + alert.backgroundColor"
                [style.color]="'#' + alert.textColor"
              >
                <img [src]="getIconImage(alert.codePointIcon)" [alt]="alert.title" class="w-5 h-5" />
                <span>{{ alert.title }}</span>
              </div>
            </td>
            <td>
              <code class="bg-surface-100 dark:bg-surface-800 px-2 py-1 rounded text-sm">{{
                alert.code
              }}</code>
            </td>
            <td>
              <img [src]="getIconImage(alert.codePointIcon)" [alt]="alert.codePointIcon" class="w-8 h-8" />
            </td>
            <td>{{ alert.title }}</td>
            <td class="text-color-secondary">{{ alert.subtitle }}</td>
            <td>
              <div class="flex gap-2 items-center">
                <div
                  class="w-6 h-6 rounded border border-surface"
                  [style.background-color]="'#' + alert.textColor"
                  [title]="'Texto: #' + alert.textColor"
                ></div>
                <div
                  class="w-6 h-6 rounded border border-surface"
                  [style.background-color]="'#' + alert.backgroundColor"
                  [title]="'Fondo: #' + alert.backgroundColor"
                ></div>
              </div>
            </td>
            <td>
              <div class="flex gap-2">
                <p-button
                  icon="pi pi-pencil"
                  severity="secondary"
                  [text]="true"
                  [rounded]="true"
                  (onClick)="onEditAlert(alert)"
                  pTooltip="Editar"
                />
                <p-button
                  icon="pi pi-trash"
                  severity="danger"
                  [text]="true"
                  [rounded]="true"
                  (onClick)="onDeleteAlert(alert)"
                  pTooltip="Eliminar"
                />
              </div>
            </td>
          </tr>
        </ng-template>
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="7" class="text-center p-4">
              <p class="text-color-secondary m-0">
                @if (searchTerm()) {
                  No se encontraron alertas que coincidan con "{{ searchTerm() }}"
                } @else {
                  No hay alertas personalizadas creadas
                }
              </p>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>
  </div>
</div>

<p-toast />
<p-confirmDialog />
