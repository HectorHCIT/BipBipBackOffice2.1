<div class="p-4">
  @if (isLoading()) {
    <div class="flex justify-center items-center py-8">
      <p-progressSpinner />
    </div>
  }

  @if (error()) {
    <p-message severity="error" [text]="error()!" styleClass="w-full mb-4" />
  }

  @if (incidents()) {
    <p-table
      [value]="incidents()!.records"
      [lazy]="true"
      [paginator]="true"
      [rows]="pageSize()"
      [totalRecords]="incidents()!.metadata.totalCount"
      [first]="(currentPage() - 1) * pageSize()"
      (onLazyLoad)="onPageChange($event)"
      [rowsPerPageOptions]="[10, 20, 50]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} incidencias"
      styleClass="p-datatable-sm"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Incidencia ID</th>
          <th>Fecha</th>
          <th>Tipo</th>
          <th>Estado</th>
          <th>Descripción</th>
          <th>Orden ID</th>
          <th>Resolución</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-incident>
        <tr>
          <td>{{ incident.incidentId }}</td>
          <td>{{ incident.incidentDate }}</td>
          <td>
            <p-tag
              [value]="incident.type"
              severity="info"
            />
          </td>
          <td>
            <p-tag
              [value]="incident.status"
              [severity]="getStatusSeverity(incident.status)"
            />
          </td>
          <td>{{ incident.description }}</td>
          <td>{{ incident.orderId || 'N/A' }}</td>
          <td>{{ incident.resolution || 'Pendiente' }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center">
            No se encontraron incidencias
          </td>
        </tr>
      </ng-template>
    </p-table>
  }
</div>
