<div class="p-4">
  @if (isLoading()) {
    <div class="flex justify-center items-center py-8">
      <p-progressSpinner />
    </div>
  }

  @if (error()) {
    <p-message severity="error" [text]="error()!" styleClass="w-full mb-4" />
  }

  @if (customerProfile()) {
    <!-- Personal Information Section -->
    <div class="mb-6">
      <h3 class="text-xl font-semibold mb-4">Información Personal</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo</label>
          <p class="text-base">{{ customerProfile()!.nombre }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
          <p class="text-base">{{ customerProfile()!.telefono }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <p class="text-base">{{ customerProfile()!.email || 'N/A' }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Género</label>
          <p class="text-base">{{ customerProfile()!.genero || 'N/A' }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de Nacimiento</label>
          <p class="text-base">{{ customerProfile()!.fechaNacimiento || 'N/A' }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de Registro</label>
          <p class="text-base">{{ customerProfile()!.fechaRegistro || 'N/A' }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Ciudad</label>
          <p class="text-base">{{ customerProfile()!.ciudad || 'N/A' }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Autorización</label>
          <p class="text-base">{{ customerProfile()!.tipoAutorizacion || 'N/A' }}</p>
        </div>
      </div>
    </div>

    <!-- Addresses Section -->
    <div>
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-xl font-semibold">Direcciones</h3>
        <div class="flex gap-2">
          <p-button
            label="Todas"
            [outlined]="addressFilter() !== 'all'"
            [severity]="addressFilter() === 'all' ? 'primary' : 'secondary'"
            size="small"
            (onClick)="setAddressFilter('all')"
          />
          <p-button
            label="Activas"
            [outlined]="addressFilter() !== 'active'"
            [severity]="addressFilter() === 'active' ? 'success' : 'secondary'"
            size="small"
            (onClick)="setAddressFilter('active')"
          />
          <p-button
            label="Inactivas"
            [outlined]="addressFilter() !== 'inactive'"
            [severity]="addressFilter() === 'inactive' ? 'danger' : 'secondary'"
            size="small"
            (onClick)="setAddressFilter('inactive')"
          />
        </div>
      </div>

      @if (paginatedAddresses().length === 0) {
        <p-message
          severity="info"
          text="No hay direcciones disponibles"
          styleClass="w-full"
        />
      } @else {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
          @for (address of paginatedAddresses(); track $index) {
            <p-card>
              <ng-template pTemplate="header">
                <div class="flex justify-between items-start p-4 pb-0">
                  <div class="flex gap-2">
                    @if (address.isMain) {
                      <p-tag value="Default" severity="info" />
                    }
                  </div>
                  <p-tag
                    [value]="address.isActive ? 'Activa' : 'Inactiva'"
                    [severity]="address.isActive ? 'success' : 'danger'"
                  />
                </div>
              </ng-template>
              <div class="space-y-2">
                <div>
                  <label class="block text-sm font-medium text-gray-700">Dirección</label>
                  <p class="text-sm">{{ address.address }}</p>
                </div>
                @if (address.reference) {
                  <div>
                    <label class="block text-sm font-medium text-gray-700">Referencia</label>
                    <p class="text-sm">{{ address.reference }}</p>
                  </div>
                }
                <div>
                  <label class="block text-sm font-medium text-gray-700">Coordenadas</label>
                  <p class="text-sm">{{ address.latitude }}, {{ address.longitude }}</p>
                </div>
              </div>
              <ng-template pTemplate="footer">
                <div class="flex justify-end">
                  <p-button
                    label="Ver en Mapa"
                    icon="pi pi-map-marker"
                    [text]="true"
                    size="small"
                    (onClick)="openInGoogleMaps(address.latitude, address.longitude)"
                  />
                </div>
              </ng-template>
            </p-card>
          }
        </div>

        <!-- Pagination -->
        @if (totalAddressPages() > 1) {
          <p-paginator
            [first]="(currentAddressPage() - 1) * addressPageSize"
            [rows]="addressPageSize"
            [totalRecords]="filteredAddresses().length"
            (onPageChange)="onAddressPageChange($event)"
          />
        }
      }
    </div>
  }
</div>
