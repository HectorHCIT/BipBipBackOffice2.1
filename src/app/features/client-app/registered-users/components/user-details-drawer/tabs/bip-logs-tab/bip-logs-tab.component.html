<div class="p-4">
  @if (isLoading()) {
    <div class="flex justify-center items-center py-8">
      <p-progressSpinner />
    </div>
  }

  @if (error()) {
    <p-message severity="error" [text]="error()!" styleClass="w-full mb-4" />
  }

  @if (transactions()) {
    <p-table
      [value]="transactions()!.records"
      [lazy]="true"
      [paginator]="true"
      [rows]="pageSize()"
      [totalRecords]="transactions()!.metadata.totalCount"
      [first]="(currentPage() - 1) * pageSize()"
      (onLazyLoad)="onPageChange($event)"
      [rowsPerPageOptions]="[10, 20, 50]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} transacciones"
      styleClass="p-datatable-sm"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Fecha</th>
          <th>Usuario</th>
          <th>Bips Ganados</th>
          <th>Comentarios</th>
          <th>Bips Totales Ganados</th>
          <th>Bips Disponibles</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-transaction>
        <tr>
          <td>{{ transaction.bipsDateCreated }}</td>
          <td>{{ transaction.bipsUser }}</td>
          <td>
            <span [class]="transaction.bipsEarned > 0 ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'">
              {{ transaction.bipsEarned > 0 ? '+' : '' }}{{ transaction.bipsEarned }}
            </span>
          </td>
          <td>{{ transaction.comments }}</td>
          <td class="font-semibold">{{ transaction.bipsCurrentlyEarned }}</td>
          <td class="font-semibold text-green-600">{{ transaction.bipsCurrentlyAvailable }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center">
            No se encontraron transacciones de Bips
          </td>
        </tr>
      </ng-template>
    </p-table>
  }
</div>
